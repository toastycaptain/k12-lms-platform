{
  "project": "k12-lms-platform",
  "branchName": "ralph/m7-institutional-hardening",
  "description": "M7: Institutional Hardening — OneRoster SIS integration, LTI 1.3 (optional), audit logging, data governance, and disaster recovery per PRD-15, PRD-23, and PRD-25",
  "userStories": [
    {
      "id": "US-097",
      "title": "OneRoster 1.1 REST client service",
      "description": "As a developer, I need an HTTP client service for consuming OneRoster 1.1 REST APIs so the platform can sync user, enrollment, and class data from district SIS systems.",
      "acceptanceCriteria": [
        "Create app/services/one_roster_client.rb with Faraday-based HTTP client",
        "Constructor accepts: base_url, client_id, client_secret (OAuth 2.0 client credentials flow)",
        "authenticate! method: POST to /token endpoint with client_credentials grant_type, caches access_token with expiry",
        "get_all_orgs: GET /ims/oneroster/v1p1/orgs — returns organizations (schools/districts)",
        "get_all_users: GET /ims/oneroster/v1p1/users — returns users with roles (teacher/student/administrator)",
        "get_all_classes: GET /ims/oneroster/v1p1/classes — returns classes with subject codes and terms",
        "get_all_enrollments: GET /ims/oneroster/v1p1/enrollments — returns class enrollments with role",
        "get_all_academic_sessions: GET /ims/oneroster/v1p1/academicSessions — returns terms/semesters",
        "All list endpoints support pagination via offset/limit params and follow Link headers for next page",
        "All list endpoints support filtering via filter param (e.g., filter=role='student')",
        "OneRosterError custom error class in app/errors/one_roster_error.rb with status_code and response_body",
        "Handles 401 by auto-refreshing token and retrying once",
        "Faraday timeout: 30 seconds connect, 60 seconds read",
        "spec/services/one_roster_client_spec.rb with WebMock stubs: test auth flow, test all endpoints, test pagination, test error handling, test token refresh",
        "All specs pass, rubocop clean"
      ],
      "priority": 1,
      "passes": false,
      "notes": "PRD-15: OneRoster is the core SIS integration standard for M7. OneRoster 1.1 REST is the most widely supported version. The client wraps the IMS Global OneRoster 1.1 REST API specification."
    },
    {
      "id": "US-098",
      "title": "OneRoster configuration and provider registration",
      "description": "As an admin, I need to configure a OneRoster SIS connection so the platform knows how to connect to our district's SIS system.",
      "acceptanceCriteria": [
        "Update IntegrationConfig::VALID_PROVIDERS to include 'oneroster'",
        "IntegrationConfig settings JSONB stores OneRoster-specific config: base_url, client_id (encrypted), client_secret (encrypted), auto_sync_enabled (boolean), sync_interval_hours (integer, default 24)",
        "Add encrypts :settings_client_id, :settings_client_secret via custom accessor methods that read/write from settings JSONB",
        "POST /api/v1/integration_configs with provider='oneroster' validates required settings: base_url, client_id, client_secret",
        "POST /api/v1/integration_configs/:id/test_connection — new member route that instantiates OneRosterClient and calls get_all_orgs with limit=1 to verify connectivity, returns { status: 'ok', org_count: N } or { status: 'error', message: '...' }",
        "Admin-only access via IntegrationConfigPolicy",
        "Factory: :oneroster_integration_config trait with valid settings",
        "spec/requests/api/v1/integration_configs_oneroster_spec.rb with tests for create, test_connection success/failure",
        "All specs pass, rubocop clean"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Extends the existing IntegrationConfig model from M5 to support OneRoster as a new provider type alongside google_classroom."
    },
    {
      "id": "US-099",
      "title": "OneRoster organization and academic session sync job",
      "description": "As an admin, I need to sync schools and academic sessions from our SIS via OneRoster so the platform stays current with district organizational data.",
      "acceptanceCriteria": [
        "Create app/jobs/one_roster_org_sync_job.rb that syncs organizations and academic sessions",
        "Job accepts integration_config_id and optional triggered_by_id",
        "Creates SyncRun with sync_type='oneroster_org_sync', direction='pull'",
        "Syncs OneRoster orgs → School records: maps sourcedId→external_id, name→name, type→metadata",
        "Only syncs orgs where type='school' (skips districts, departments)",
        "Syncs OneRoster academicSessions → AcademicYear/Term records: maps dateLastModified, startDate, endDate",
        "Sessions with type='schoolYear' map to AcademicYear, type='term'/'semester'/'gradingPeriod' map to Term",
        "Creates SyncMapping for each synced entity (local_type='School'/'AcademicYear'/'Term', external_type='oneroster_org'/'oneroster_academic_session')",
        "Update SyncMapping::VALID_LOCAL_TYPES to include 'School', 'AcademicYear', 'Term'",
        "Update SyncMapping::VALID_EXTERNAL_TYPES to include 'oneroster_org', 'oneroster_academic_session', 'oneroster_class', 'oneroster_user', 'oneroster_enrollment'",
        "Update SyncRun::VALID_SYNC_TYPES to include 'oneroster_org_sync', 'oneroster_user_sync', 'oneroster_class_sync', 'oneroster_enrollment_sync'",
        "Idempotent: updates existing records if SyncMapping already exists, creates new if not",
        "Logs info/warn/error via SyncRun#log_info/log_warn/log_error",
        "POST /api/v1/integration_configs/:id/sync_orgs — triggers the job, returns 202",
        "spec/jobs/one_roster_org_sync_job_spec.rb with mocked OneRosterClient",
        "All specs pass, rubocop clean"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Uses existing SyncRun/SyncLog/SyncMapping infrastructure from M5. The job is idempotent per Tech Spec 2.7."
    },
    {
      "id": "US-100",
      "title": "OneRoster user and enrollment sync job",
      "description": "As an admin, I need to sync users and class enrollments from our SIS via OneRoster so teachers and students are automatically provisioned in the platform.",
      "acceptanceCriteria": [
        "Create app/jobs/one_roster_user_sync_job.rb that syncs users from OneRoster",
        "Maps OneRoster user fields: sourcedId, givenName→first_name, familyName→last_name, email, roles",
        "OneRoster role mapping: 'teacher'→teacher role, 'student'→student role, 'administrator'→admin role",
        "Creates User record with tenant, assigns appropriate role via user.add_role",
        "Skips users without email addresses (logs warning)",
        "Creates SyncMapping for each user (local_type='User', external_type='oneroster_user')",
        "Create app/jobs/one_roster_class_sync_job.rb that syncs classes→Courses and enrollments",
        "Maps OneRoster class fields: sourcedId, title→name, classCode→code, subjects, terms",
        "Links course to AcademicYear via term's academic session SyncMapping",
        "Create app/jobs/one_roster_enrollment_sync_job.rb that syncs enrollments",
        "Maps OneRoster enrollment: class sourcedId→course (via SyncMapping), user sourcedId→user (via SyncMapping), role→enrollment role",
        "Creates Section if needed (one default section per course), then creates Enrollment",
        "All three jobs use SyncRun lifecycle (start!/complete!/fail!) and logging",
        "All three jobs are idempotent (update existing, skip duplicates)",
        "POST /api/v1/integration_configs/:id/sync_users — triggers user sync, returns 202",
        "POST /api/v1/integration_configs/:id/sync_classes — triggers class sync, returns 202",
        "POST /api/v1/integration_configs/:id/sync_enrollments — triggers enrollment sync, returns 202",
        "Comprehensive specs for all three jobs with mocked OneRosterClient",
        "All specs pass, rubocop clean"
      ],
      "priority": 4,
      "passes": false,
      "notes": "PRD-15: OneRoster user/enrollment sync is the primary value of SIS integration. Users are created with email-based lookup to avoid duplicates. Enrollments require both user and class sync to have run first."
    },
    {
      "id": "US-101",
      "title": "OneRoster CSV bulk import job",
      "description": "As an admin, I need to import OneRoster CSV files so schools without a REST API can still bulk-import SIS data.",
      "acceptanceCriteria": [
        "Create app/jobs/one_roster_csv_import_job.rb that processes a ZIP file of OneRoster CSVs",
        "Accepts integration_config_id and Active Storage blob_id for the uploaded ZIP",
        "Expects standard OneRoster CSV filenames: orgs.csv, users.csv, classes.csv, enrollments.csv, academicSessions.csv",
        "Parses CSV files in dependency order: orgs → academicSessions → users → classes → enrollments",
        "Reuses the same mapping logic as the REST sync jobs (creates SyncMappings, idempotent)",
        "Validates CSV headers match OneRoster 1.1 spec (sourcedId, status, dateLastModified, etc.)",
        "Skips rows with status='tobedeleted' (logs info)",
        "Creates SyncRun with sync_type='oneroster_csv_import', direction='pull'",
        "POST /api/v1/integration_configs/:id/import_csv — accepts multipart file upload, validates ZIP, enqueues job, returns 202",
        "GET /api/v1/integration_configs/:id/import_status — returns latest CSV import SyncRun status",
        "IntegrationConfig has_one_attached :import_file via Active Storage",
        "spec/jobs/one_roster_csv_import_job_spec.rb with fixture ZIP containing sample CSVs",
        "Create spec/fixtures/oneroster_sample.zip with minimal valid CSVs (2 orgs, 3 users, 2 classes, 4 enrollments, 2 sessions)",
        "All specs pass, rubocop clean"
      ],
      "priority": 5,
      "passes": false,
      "notes": "Many smaller schools use OneRoster CSV export from their SIS rather than REST API. The CSV format follows IMS Global OneRoster 1.1 CSV specification."
    },
    {
      "id": "US-102",
      "title": "LTI 1.3 tool registration model and configuration",
      "description": "As an admin, I need to register external LTI 1.3 tools so teachers can launch third-party learning tools from within our platform.",
      "acceptanceCriteria": [
        "Create migration for lti_registrations table: tenant_id, name, description, issuer, client_id, auth_login_url, auth_token_url, jwks_url, deployment_id, status (active/inactive), settings (JSONB), created_by_id, timestamps",
        "Create app/models/lti_registration.rb: TenantScoped, VALID_STATUSES, validates required fields (name, issuer, client_id, auth_login_url, auth_token_url, jwks_url), activate!/deactivate!",
        "Create migration for lti_resource_links table: tenant_id, lti_registration_id, title, description, url, custom_params (JSONB), course_id (optional), timestamps",
        "Create app/models/lti_resource_link.rb: TenantScoped, belongs_to :lti_registration, belongs_to :course (optional)",
        "LtiRegistrationPolicy: admin-only CRUD",
        "LtiResourceLinkPolicy: admin/curriculum_lead can create/update/destroy, teachers can index/show",
        "LtiRegistrationSerializer: all fields except sensitive tokens",
        "CRUD API for lti_registrations: full REST endpoints",
        "CRUD API for lti_resource_links nested under lti_registrations",
        "Factories for both models",
        "Model specs and request specs",
        "All specs pass, rubocop clean"
      ],
      "priority": 6,
      "passes": false,
      "notes": "PRD-15: LTI is marked optional but is essential for tool interoperability. LTI 1.3 uses OpenID Connect for authentication and JWT for message signing."
    },
    {
      "id": "US-103",
      "title": "LTI 1.3 launch and deep linking endpoints",
      "description": "As a teacher, I need to launch external LTI tools from the platform so I can use third-party content and activities within my courses.",
      "acceptanceCriteria": [
        "Create app/services/lti_service.rb with methods: build_login_request, validate_id_token, build_launch_message, build_deep_link_response",
        "Add jwt gem to Gemfile for JWT signing/verification",
        "Generate RSA keypair for platform: store in Rails credentials (or env vars) as LTI_PLATFORM_PRIVATE_KEY",
        "GET /api/v1/lti/jwks — returns platform's JWKS (public key set) for tool verification",
        "POST /api/v1/lti/login — OIDC login initiation: validates registration, builds auth redirect URL with nonce/state",
        "POST /api/v1/lti/launch — receives id_token from tool's OIDC redirect, validates JWT signature against tool's JWKS, creates LTI launch context with user claims and course context, returns launch URL with signed JWT",
        "POST /api/v1/lti/deep_link — handles deep linking response: validates content_items JWT from tool, creates LtiResourceLink records for selected items",
        "LTI launch message includes required claims: iss, sub, aud, exp, iat, nonce, deployment_id, target_link_uri, roles (mapped from platform roles), context (course info)",
        "LtiLaunch model (non-persisted) encapsulates launch state for the redirect flow",
        "spec/services/lti_service_spec.rb with JWT signing/verification tests",
        "spec/requests/api/v1/lti_spec.rb with login, launch, deep_link endpoint tests",
        "All specs pass, rubocop clean"
      ],
      "priority": 7,
      "passes": false,
      "notes": "LTI 1.3 uses a two-step OIDC flow: 1) platform initiates login to tool, 2) tool redirects back with id_token. The platform acts as both LTI Platform (launching tools) and optionally Tool Provider."
    },
    {
      "id": "US-104",
      "title": "LTI Assignment and Grade Services (AGS)",
      "description": "As a teacher, I need grades from LTI tools to flow back into the platform gradebook so all scores are in one place.",
      "acceptanceCriteria": [
        "Create app/services/lti_ags_service.rb implementing LTI AGS (Assignment and Grade Services) 2.0",
        "GET /api/v1/lti/ags/lineitems — returns line items (grade columns) for the course context, maps to local Assignment records",
        "POST /api/v1/lti/ags/lineitems — tool creates a new line item (creates Assignment with lti_source flag)",
        "GET /api/v1/lti/ags/lineitems/:id — returns single line item",
        "GET /api/v1/lti/ags/lineitems/:id/results — returns scores/results for a line item",
        "POST /api/v1/lti/ags/lineitems/:id/scores — tool posts score for a user, creates/updates Submission grade",
        "All AGS endpoints validate the LTI access token (OAuth 2.0 bearer token with scope validation)",
        "LTI scopes: lineitem (read/write), result (read), score (write)",
        "LtiAccessToken model or service that validates and caches tool access tokens via client_credentials grant",
        "Scores posted via AGS auto-create Submission if none exists (status: 'graded')",
        "spec/requests/api/v1/lti_ags_spec.rb with full endpoint tests",
        "All specs pass, rubocop clean"
      ],
      "priority": 8,
      "passes": false,
      "notes": "LTI AGS is the grade passback mechanism in LTI 1.3, replacing the older Basic Outcomes service. Tools use OAuth 2.0 client_credentials to get access tokens for AGS endpoints."
    },
    {
      "id": "US-105",
      "title": "AuditLog model with comprehensive event logging",
      "description": "As an admin, I need a comprehensive audit trail of all significant system events so I can review who did what and when for governance and compliance.",
      "acceptanceCriteria": [
        "Create migration for audit_logs table: tenant_id, user_id, action (string), auditable_type (string), auditable_id (bigint), changes (JSONB), metadata (JSONB), ip_address (string), user_agent (string), created_at (indexed)",
        "Create app/models/audit_log.rb: TenantScoped, belongs_to :user (optional, for system events), belongs_to :auditable (polymorphic), scopes: for_user, for_auditable, for_action, recent (ordered desc)",
        "VALID_ACTIONS: create, update, destroy, publish, archive, approve, reject, sign_in, sign_out, export, sync, ai_generate",
        "Create app/services/audit_logger.rb with class method: AuditLogger.log(action:, auditable:, user:, changes: {}, metadata: {}, request: nil)",
        "AuditLogger extracts ip_address and user_agent from request object when provided",
        "Create app/controllers/concerns/auditable.rb concern: after_action callbacks that auto-log create/update/destroy actions on the controller's resource",
        "Include Auditable concern in key controllers: UnitPlansController, AssignmentsController, QuizzesController, IntegrationConfigsController, AiProviderConfigsController, AiTaskPoliciesController",
        "Log sign_in/sign_out events in SessionsController",
        "Log AI generation events in AiGenerationsController",
        "GET /api/v1/audit_logs — admin-only index with filters: user_id, auditable_type, action, date range (start_date, end_date)",
        "GET /api/v1/audit_logs — supports pagination via page/per_page params (default 50 per page)",
        "GET /api/v1/audit_logs/summary — returns counts by action type and by day for last 30 days",
        "AuditLogPolicy: admin-only for all actions",
        "Database index on [tenant_id, created_at] and [tenant_id, auditable_type, auditable_id]",
        "Factory and comprehensive specs: model spec, service spec, request spec",
        "All specs pass, rubocop clean"
      ],
      "priority": 9,
      "passes": false,
      "notes": "Tech Spec 2.11: Audit logs are a core security and observability requirement. The polymorphic design allows logging changes to any model. JSONB changes column stores before/after values."
    },
    {
      "id": "US-106",
      "title": "Data retention policy model and enforcement job",
      "description": "As an admin, I need to configure data retention policies so the platform automatically manages data lifecycle according to our school's compliance requirements.",
      "acceptanceCriteria": [
        "Create migration for data_retention_policies table: tenant_id, name, entity_type (string), retention_days (integer), action (archive/anonymize/delete), enabled (boolean), settings (JSONB), created_by_id, timestamps",
        "Create app/models/data_retention_policy.rb: TenantScoped, VALID_ENTITY_TYPES = %w[audit_log sync_log ai_invocation quiz_attempt submission], VALID_ACTIONS = %w[archive anonymize delete]",
        "Validates retention_days >= 30 (minimum 30-day retention)",
        "Create app/jobs/data_retention_enforcement_job.rb that processes all enabled policies for the tenant",
        "For action='delete': destroys records older than retention_days",
        "For action='archive': marks records with archived_at timestamp (requires adding archived_at column to applicable tables via migration)",
        "For action='anonymize': nullifies user-identifiable fields (email, name, ip_address) on records older than retention_days",
        "Job creates AuditLog entry for each enforcement run with count of affected records",
        "Job is safe: processes in batches of 1000 to avoid memory issues",
        "CRUD API for data_retention_policies: admin-only",
        "POST /api/v1/data_retention_policies/:id/run — manually trigger enforcement for a single policy, returns 202",
        "Factory, model spec, job spec, request spec",
        "All specs pass, rubocop clean"
      ],
      "priority": 10,
      "passes": false,
      "notes": "PRD-15 Governance: Data retention is essential for FERPA/COPPA compliance in K-12 settings. The 30-day minimum prevents accidental data loss."
    },
    {
      "id": "US-107",
      "title": "Tenant data export job for disaster recovery",
      "description": "As an admin, I need to export all my school's data so we have backup copies for disaster recovery and data portability.",
      "acceptanceCriteria": [
        "Create app/jobs/tenant_data_export_job.rb that exports all tenant data to a ZIP file",
        "Exports each model as a separate JSON file: users.json, courses.json, unit_plans.json (with versions), lesson_plans.json (with versions), assignments.json, submissions.json, questions.json, quizzes.json, standards.json, enrollments.json",
        "Each JSON file contains an array of serialized records (using existing AMS serializers where available)",
        "Excludes sensitive fields: encrypted tokens, API keys, password digests",
        "Includes metadata.json with: tenant info, export timestamp, record counts per model, platform version",
        "ZIP file attached to tenant via has_one_attached :data_export on Tenant model",
        "POST /api/v1/tenant/export — admin-only, enqueues job, returns 202 with { job_id: id }",
        "GET /api/v1/tenant/export_status — returns { status: processing/completed/failed, download_url: signed_url }",
        "Export runs within tenant scope (only exports current tenant's data)",
        "Job creates AuditLog entry on completion",
        "Large tables (submissions, quiz_attempts) exported in streaming fashion to avoid memory issues",
        "spec/jobs/tenant_data_export_job_spec.rb",
        "spec/requests/api/v1/tenant_export_spec.rb",
        "All specs pass, rubocop clean"
      ],
      "priority": 11,
      "passes": false,
      "notes": "PRD-15 DR: Tenant data export provides data portability and supports disaster recovery. The export format is designed for re-import or archival."
    },
    {
      "id": "US-108",
      "title": "Row-Level Security for PostgreSQL tenant isolation",
      "description": "As a developer, I need PostgreSQL Row-Level Security policies so tenant data isolation is enforced at the database level as a defense-in-depth measure.",
      "acceptanceCriteria": [
        "Create migration that adds RLS policies to all tenant-scoped tables",
        "For each table with tenant_id: CREATE POLICY tenant_isolation ON {table} USING (tenant_id = current_setting('app.current_tenant_id')::bigint)",
        "ALTER TABLE {table} ENABLE ROW LEVEL SECURITY",
        "Create app/models/concerns/rls_tenant.rb concern that sets current_setting('app.current_tenant_id') on the connection before queries",
        "Include RlsTenant in ApplicationRecord or call in ApplicationController before_action",
        "SET LOCAL app.current_tenant_id = {tenant_id} executed within each request transaction",
        "RLS bypass for migrations and seeds: ALTER ROLE {app_user} SET row_security = off for superuser, ON for app user",
        "Create a dedicated database role for the app (non-superuser) that has RLS enforced",
        "RLS policies use PERMISSIVE mode (default) so they combine with existing application-level scoping",
        "Add config/initializers/rls.rb that conditionally enables RLS based on ENABLE_RLS env var (default: false in development/test, true in production)",
        "spec/models/concerns/rls_tenant_spec.rb verifying tenant isolation at DB level",
        "All existing specs continue to pass (RLS disabled in test env by default)",
        "All specs pass, rubocop clean"
      ],
      "priority": 12,
      "passes": false,
      "notes": "Tech Spec 2.3: 'Optional: Postgres Row-Level Security (later phase)'. RLS provides defense-in-depth for tenant isolation beyond application-level scoping. Disabled by default in dev/test."
    },
    {
      "id": "US-109",
      "title": "Admin OneRoster configuration and sync management page",
      "description": "As an admin, I need a UI to configure OneRoster SIS connections and trigger/monitor sync operations.",
      "acceptanceCriteria": [
        "Create apps/web/src/app/admin/oneroster/page.tsx",
        "Configuration section: form for base_url, client_id (password field), client_secret (password field), auto_sync toggle, sync_interval_hours",
        "Test Connection button: calls POST /integration_configs/:id/test_connection, shows success/failure status",
        "Sync Actions section: buttons for Sync Organizations, Sync Users, Sync Classes, Sync Enrollments — each triggers respective POST endpoint",
        "CSV Import section: file upload input (accepts .zip), calls POST /integration_configs/:id/import_csv",
        "Sync History section: table of SyncRuns for this integration with status badges, timestamps, and expandable log rows",
        "Shows sync mapping counts: total users synced, courses synced, enrollments synced",
        "Error states: connection failure, sync in progress (disable buttons), sync failed with error message",
        "Add 'SIS / OneRoster' to AppShell Admin nav children",
        "Next.js lint, typecheck, and build all pass"
      ],
      "priority": 13,
      "passes": false,
      "notes": "Extends the Admin section with OneRoster management. Reuses the sync dashboard patterns from M5 Google integrations."
    },
    {
      "id": "US-110",
      "title": "Admin LTI tool management page",
      "description": "As an admin, I need a UI to register and manage LTI 1.3 tools so I can control which external tools are available to teachers.",
      "acceptanceCriteria": [
        "Create apps/web/src/app/admin/lti/page.tsx",
        "List of registered LTI tools with status badge (active/inactive), name, issuer, deployment_id",
        "Add Tool form: name, issuer URL, client_id, auth_login_url, auth_token_url, jwks_url, deployment_id",
        "Edit tool: inline edit for name, status toggle (activate/deactivate), delete with confirmation",
        "Platform Info section: displays this platform's issuer URL, JWKS URL, and redirect URLs for tool registration",
        "Resource Links section per tool: list of created resource links with title, URL, linked course",
        "Add Resource Link form: title, URL, custom parameters (key-value pairs), optional course selector",
        "Tool launch test button: opens tool launch in new window via POST /api/v1/lti/login",
        "Add 'LTI Tools' to AppShell Admin nav children",
        "Next.js lint, typecheck, and build all pass"
      ],
      "priority": 14,
      "passes": false,
      "notes": "PRD-15: LTI management UI. The platform info section helps admins register the platform with external tool vendors."
    },
    {
      "id": "US-111",
      "title": "Admin Governance Dashboard with audit log and data management",
      "description": "As an admin, I need a governance dashboard to view audit logs, manage data retention policies, and export tenant data for compliance and disaster recovery.",
      "acceptanceCriteria": [
        "Create apps/web/src/app/admin/governance/page.tsx",
        "Three-tab layout: Audit Log, Data Retention, Data Export",
        "Audit Log tab: table of audit_logs with filters — action type dropdown, auditable_type dropdown, user search, date range picker",
        "Audit Log tab: summary stats cards showing counts by action type for last 30 days (from /audit_logs/summary)",
        "Audit Log tab: pagination controls (previous/next) with 50 items per page",
        "Audit Log tab: each row shows timestamp, user email, action, entity type, entity ID, expandable changes JSON",
        "Data Retention tab: list of retention policies with name, entity_type, retention_days, action, enabled toggle",
        "Data Retention tab: add policy form with entity_type dropdown, retention_days input (min 30), action dropdown (archive/anonymize/delete), enabled checkbox",
        "Data Retention tab: run policy button (triggers manual enforcement), delete policy with confirmation",
        "Data Export tab: Export All Data button that triggers POST /api/v1/tenant/export",
        "Data Export tab: shows export status (processing/completed) with download link when complete",
        "Data Export tab: last export timestamp and file size",
        "Add 'Governance' to AppShell Admin nav children",
        "Next.js lint, typecheck, and build all pass"
      ],
      "priority": 15,
      "passes": false,
      "notes": "PRD-15 Governance and DR: This dashboard provides the admin UI for all governance, compliance, and disaster recovery features. Combines audit logging, retention policies, and data export in one location."
    }
  ]
}
